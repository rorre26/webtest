<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Telegram Pong â€” Vertical</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body,html {margin:0;padding:0;background:#0f1115;color:#fff;overflow:hidden;}
    canvas {display:block;width:100vw;height:100vh;background:#000;}
  </style>
</head>
<body>
  <canvas id="game"></canvas>
  <script>
    const tg = window.Telegram?.WebApp;
    if (tg) { tg.expand(); tg.ready(); }

    const cvs = document.getElementById('game');
    const ctx = cvs.getContext('2d');
    let W,H;

    function resize(){
      W = cvs.width = window.innerWidth;
      H = cvs.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    const PADDLE_W = 100, PADDLE_H = 12, BALL = 12;
    const player = {x: W/2 - PADDLE_W/2, y: H - 30, vx:0, score:0};
    const enemy  = {x: W/2 - PADDLE_W/2, y: 18, vx:0, score:0};
    const ball   = {x: W/2, y: H/2, vx:3, vy:3};

    let keys = {};
    window.addEventListener('keydown', e=>keys[e.key]=true);
    window.addEventListener('keyup', e=>keys[e.key]=false);

    cvs.addEventListener('pointermove', e=>{
      const rect = cvs.getBoundingClientRect();
      const x = (e.clientX - rect.left) * (W/rect.width) - PADDLE_W/2;
      if (e.clientY > H/2) player.x = x;
    });

    function step(){
      if (keys['ArrowLeft'] || keys['a']) player.x -= 6;
      if (keys['ArrowRight']|| keys['d']) player.x += 6;
      player.x = Math.max(0, Math.min(W-PADDLE_W, player.x));

      // simple AI for enemy
      if (enemy.x + PADDLE_W/2 < ball.x) enemy.x += 4;
      else enemy.x -= 4;
      enemy.x = Math.max(0, Math.min(W-PADDLE_W, enemy.x));

      // move ball
      ball.x += ball.vx;
      ball.y += ball.vy;

      // walls X
      if (ball.x<0 || ball.x>W-BALL) ball.vx *= -1;

      // top paddle
      if (ball.y < enemy.y+PADDLE_H && ball.x+BALL>enemy.x && ball.x<enemy.x+PADDLE_W && ball.vy<0){
        ball.vy = Math.abs(ball.vy);
      }
      // bottom paddle
      if (ball.y+BALL > player.y && ball.x+BALL>player.x && ball.x<player.x+PADDLE_W && ball.vy>0){
        ball.vy = -Math.abs(ball.vy);
      }

      // score
      if (ball.y < -BALL){ player.score++; resetBall(1); }
      if (ball.y > H+BALL){ enemy.score++; resetBall(-1); }
    }

    function resetBall(dir){
      ball.x = W/2; ball.y = H/2;
      ball.vx = (Math.random()>0.5?1:-1)*(3+Math.random()*2);
      ball.vy = dir*(3+Math.random()*2);
    }

    function draw(){
      ctx.clearRect(0,0,W,H);
      ctx.fillStyle = '#fff';
      ctx.fillRect(player.x, player.y, PADDLE_W, PADDLE_H);
      ctx.fillRect(enemy.x, enemy.y, PADDLE_W, PADDLE_H);
      ctx.fillRect(ball.x, ball.y, BALL, BALL);
      ctx.font = '20px sans-serif';
      ctx.fillText(player.score, 20, H-20);
      ctx.fillText(enemy.score, 20, 40);
    }

    function loop(){
      step();
      draw();
      requestAnimationFrame(loop);
    }
    loop();
  </script>
</body>
</html>
